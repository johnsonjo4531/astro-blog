class t{constructor(){this._observers=new Set}registerObserver(t){if(!t.update)throw new Error("No update method on observer");this._observers.add(t)}unregisterObserver(t){this._observers.remove(t)}notifyObservers(t=this){for(var e of this._observers)e.update(t)}}class e extends t{constructor(){super(),this._symbols=new Set,this._boardSize=9,this.resetBoard(),this._solutions=[],this._stats="",this._error_message="",this.textFile=void 0}async setSolutionAndStats(){try{this._error_message="";var[t,e]=await getSolutions(this.boardClone,this.symbols);this._solutions=t,this._stats=e.printStats(),this.notifyObservers()}catch(t){console.error(t),this._error_message=t.message,this._solutions=[],this._stats="",this.notifyObservers()}}get error_message(){return this._error_message}get solutions(){return this._solutions}get stats(){return this._stats}resetBoard(){this._board=new Array(this._boardSize).fill(0).map((()=>new Array(this._boardSize).fill("-")))}get boardClone(){return this._board.map((t=>t.slice()))}get board(){return this._board}set boardSize(t){if(-1===[2,3,4,5].map((t=>t**2)).indexOf(t))throw new Error("Invalid board size");this._boardSize=t,this.resetBoard(),this.notifyObservers()}get boardSize(){return this._boardSize}set symbols(t){if((t=[...t]).some((t=>1!==t.length)))throw new Error("Some symbols have length greater than 1.");this._symbols=new Set(t),this.notifyObservers()}get symbols(){return this._symbols}setCell(t,e){var s=this.boardSize,i=Math.floor(t/s),o=Math.floor(t%s);this.board[i][o]!==e&&(this.board[i][o]=e,this.notifyObservers())}get boardString(){return boardToString(this.board)}setCellRowCol(t,e,s){this.board[t][e]!==s&&(this.board[t][e]=s,this.notifyObservers())}makeInputFile(){var t=new Blob([this.boardSize+"\n"+[...this.symbols].join(" ")+"\n"+this.boardString],{type:"text/plain"});return null!==this.textFile&&window.URL.revokeObjectURL(this.textFile),this.textFile=window.URL.createObjectURL(t),this.textFile}getCell(t){var e=this.boardSize,s=Math.floor(t/e),i=Math.floor(t%e);return this.board[s][i]}}var s=t=>t.replace(/[\u00A0-\u9999<>\&]/gim,(function(t){return"&#"+t.charCodeAt(0)+";"}));function i(t,e){return t.map(e).join("")}function o(t){return new Promise((e=>setTimeout(e,t)))}class r{constructor(t,e){this.model=t,this.view=$(e),this.lastSize=this.model.boardSize,this.model.registerObserver(this),this.lastBoardStr=this.model.boardString,this.render(),this.lastUpdateAttempt=Date.now()}render(){var t=0,e=$(document.getSelection().anchorNode);e.is("input[data-cell-id]")||(e=e.find("input[data-cell-id]"));var o=e.attr("data-cell-id"),r=[(e.get(0)||{}).selectionStart,(e.get(0)||{}).selectionEnd];this.view.html(`\n      <div class="sudoku-board">\n        ${i(this.model.board,(e=>{var o=Number(this.model.boardSize);return`<div class="sudoku-row clearfix row-${o}x${o}">\n            ${i(e,(e=>`<div class="cell cell-${o}x${o}">\n              <div class="cell-inner">\n                <input data-cell-id="${t++}" type="text" value="${s(e)}">\n              </div>\n            </div>`))}\n          </div>`}))}\n      </div>`),$(`input[data-cell-id="${o}"]`).focus();var a=(t,e=(t=>!!t))=>{var s={do:function(i){return e(t)?a(i(t),e):s},_x:t};return s};a($(`input[data-cell-id="${o}"]`).get(0)).do((t=>t.setSelectionRange(...r)))}async debounce(t,e){var s=Date.now();this.lastUpdateAttempt=s,await o(e),s===this.lastUpdateAttempt&&t()}async update(t){this.debounce((()=>{this.lastBoardStr===this.model.boardString&&this.lastSize===this.model.boardSize||(this.lastBoardStr=this.model.boardString,this.lastSize=this.model.boardSize,this.render())}),25)}}class a{constructor(t,e){this.model=t,this.view=$(e),this.lastSymbols=new Set([...this.model.symbols]),this.model.registerObserver(this),this.render()}render(){var t=this.model.symbols,e=$('<input class="form-control" type="text">');e.val([...t].join(",")),e.find(`option[value="${this.model.boardSize}"]`).attr("selected",!0),this.view.empty().append(e)}update(){var t,e;(t=this.lastSymbols,e=this.model.symbols,t.size!==e.size||t.size!=new Set([...t,...e]).size)&&(this.lastSymbols=new Set([...this.model.symbols]),this.render())}}class n{constructor(t,e){this.model=t,this.view=$(e),this.lastBoardSize=this.model.boardSize,this.model.registerObserver(this),this.render()}render(){this.view=this.view.html('<select class="form-control">\n      <option value="4">4x4</option>\n      <option value="9">9x9</option>\n      <option value="16">16x16</option>\n      <option value="25">25x25</option>\n    </select>'),this.view.find(`option[value="${this.model.boardSize}"]`).attr("selected",!0)}update(){this.lastBoardSize!==this.model.boardSize&&(this.lastBoardSize=this.model.boardSize,this.render())}}function l(t){var e=Number(t.length);return`\n  <div class="sudoku-board">\n    ${i(t,(t=>`<div class="sudoku-row clearfix row-${e}x${e}">\n        ${i(t,(t=>`<div class="cell cell-${e}x${e}">\n          <div class="cell-inner">\n            ${s(t)}\n          </div>\n        </div>`))}\n      </div>`))}\n  </div>`}class d{constructor(t,e){this.model=t,this.view=$(e),this.lastSize=this.model.boardSize,this.model.registerObserver(this),this.lastBoardStr=this.model.boardString,this.lastStats=this.model.stats}render(){var t="No Solutions",e=!1,s=!1;this.model.error_message?(t="Error",s=!0):this.model.solutions.length>1?(t="Multiple Solutions",e=!0):1==this.model.solutions.length&&(t="Solved",e=!0);this.view.html(`\n      <h2>Output</h2>\n      <h3>${t}</h3>\n      ${this.model.solutions.map(l).join("")}\n      ${e?`<pre><code>${this.model.stats}</code></pre>`:""}\n      ${s?`<pre><code>${this.model.error_message}</code></pre>`:""}\n      `)}async debounce(t,e){var s=Date.now();this.lastUpdateAttempt=s,await o(e),s===this.lastUpdateAttempt&&t()}update(){this.debounce((()=>{(this.lastBoardStr!==this.model.boardString||this.model.error_message||this.model.stats!==this.lastStats)&&(this.lastBoardStr=this.model.boardString,this.render())}),1e3/60)}}$(document.body).on("click",".cell-inner",(function(t){$(this).find("input").focus()}));var h=new class{constructor(){this.model=new e,this.boardSizeInput=$("#sudoku-boardSizeInput"),this.symbolInput=$("#sudoku-symbolInput"),this.inputBoard=$("#sudoku-inputBoard"),this.output=$("#output"),this.boardInputView=new r(this.model,this.inputBoard),this.symbolInputView=new a(this.model,this.symbolInput),this.sizeInputView=new n(this.model,this.boardSizeInput),this.outputView=new d(this.model,this.output)}cellKeyup(t,e){var s=e.key;if(this.validKey(s)){var i=parseInt($(t).attr("data-cell-id"),10);this.model.setCell(i,s)}}validKey(t){var e=[...this.model.symbols,"-"];return new Set(e).has(t)}isActionKeyCode(t){return new Set([17,9,16,8]).has(t)}isDirectionalKeyCode(t){return new Set([37,38,39,40]).has(t)}cellInBounds(t){return t>=0&&t<this.model.boardSize*this.model.boardSize}changeCell(t,e){var s=this.model.boardSize,i=this.model.boardSize**2;1===Math.abs(t-e)?t=Math.floor(e/s)*s+(t+s)%s:t=(t+i)%i;return this.cellInBounds(t)?t:e}handleDirectionalKeyCode(t,e){var s=parseInt($(t).attr("data-cell-id"));switch(e){case 37:$(`[data-cell-id="${this.changeCell(s-1,s)}"]`).focus();break;case 38:$(`[data-cell-id="${this.changeCell(s-this.model.boardSize,s)}"]`).focus();break;case 39:$(`[data-cell-id="${this.changeCell(s+1,s)}"]`).focus();break;case 40:$(`[data-cell-id="${this.changeCell(s+this.model.boardSize,s)}"]`).focus()}}cellKeydown(t,e){var s=e.key,i=e.keyCode||e.which;if(!this.validKey(s))return this.isDirectionalKeyCode(i)?void this.handleDirectionalKeyCode(t,i):(this.isActionKeyCode(i)&&8===i&&($(t).val(""),this.cellKeyup(t,{keyCode:189,key:"-"})),void e.preventDefault());$(t).val("")}outputSolutions(){this.model.setSolutionAndStats()}boardSizeInputChange(t,e){this.model.boardSize=parseInt($(t).val(),10)}readBoardFile(t,e){var s=t.result,{boardSize:i,symbolset:o,board:r}=parseBoard(s);this.model.boardSize=i,this.model.symbols=o;for(var a=0;a<i;++a)for(var n=0;n<i;++n)this.model.setCellRowCol(a,n,r[a][n])}downloadFile(t){var e=document.createElement("a"),s=Number(this.model.boardSize);e.setAttribute("download",`sudoku_board${s}x${s}.txt`),e.href=this.model.makeInputFile(),document.body.appendChild(e),window.requestAnimationFrame((function(){var t=new MouseEvent("click");e.dispatchEvent(t),document.body.removeChild(e)}))}symbolInputChange(t,e){this.model.symbols=$(t).val().split(",")}};h.inputBoard.on("keydown",'.cell-inner input[type="text"]',(function(t){h.cellKeydown(this,t)})),h.inputBoard.on("keyup",'.cell-inner input[type="text"]',(function(t){h.cellKeyup(this,t)})),h.boardSizeInput.on("change","select",(function(t){h.boardSizeInputChange(this)})),h.symbolInput.on("change",'input[type="text"]',(function(t){h.symbolInputChange(this)})),$("#file_input").on("change",(function(){var t=new FileReader;t.onloadend=function(t){h.readBoardFile(this,t)},t.readAsText(this.files[0])})),$("#submit").on("click",(function(t){h.outputSolutions()})),$("#download").on("click",(function(t){h.downloadFile(t)}));
//# sourceMappingURL=index.c6dec3aa.js.map
