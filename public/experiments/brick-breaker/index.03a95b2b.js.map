{"mappings":"imBAsBA,IAAAA,EACAC,E,iFArBA,IAAIC,EAAU,CAAC,EAoBfF,EAlBA,SAAkBG,GAGhB,IAFA,IAAIC,EAAOC,OAAOD,KAAKD,GAEdG,EAAI,EAAGA,EAAIF,EAAKG,OAAQD,IAC/BJ,EAAQE,EAAKE,IAAMH,EAAMC,EAAKE,GAElC,EAaAL,EAXA,SAAiBO,GACf,IAAIC,EAAWP,EAAQM,GAEvB,GAAgB,MAAZC,EACF,MAAM,IAAIC,MAAM,oCAAsCF,GAGxD,OAAOC,CACT,C,ICpBAE,EAAA,SAAAC,SAA8CC,KAAKC,MAAM,4E,MCAzDC,EAAiB,IAAAC,IAAoB,MAAQL,EAAA,SAAAM,QAA6C,SAAAC,OAAAC,KAAAC,KAAUC,WCApGC,OAAOC,aAAe,SAAuBC,GAC3C,IAAIC,EAAiBD,EACrB,IAAIE,EAAmBF,EAAOG,WAAW,OACzCH,EAASI,SAASC,cAAc,WACzBC,MAAQL,EAAeK,MAC9BN,EAAOO,OAASN,EAAeM,OAC/B,IAAIC,EAAWR,EAAOG,WAAW,MACjC,MAAMM,EAAWD,EAAQE,qBAAqB,EAAG,EAAGC,KAAKC,KAAKD,KAAKE,IAAIb,EAAOM,MAAM,GAAKK,KAAKE,IAAIb,EAAOO,OAAQ,IAAI,EAAE,EAAE,GACzHE,EAASK,aAAa,EAAE,uBACxBL,EAASK,aAAa,EAAG,mBACzB,IAAIC,EAAUC,WAAA,IAAAxB,IAAAD,IACd,MAAM0B,EAAa,gJACnB,IAAIX,EAAQN,EAAOM,MACfC,EAASP,EAAOO,OAChBW,EAAOlB,EAAOM,MAAQ,IA2B1B,IAAIa,EAAgB,KA4CpB,SAASC,EAAcC,GACrB,MAAO,GAAGV,KAAKW,IAAIC,EAAoBF,EAAKG,KAAMH,EAAKf,OA0GzD,SAA+BC,GAC7B,OAAOgB,EAAoB,IAAKhB,EAClC,CA5GiEkB,CAAqBJ,EAAKd,cAAcU,GACzG,CAEA,IAAIS,EAAYN,EAAa,CAC3BI,KAAM,aACNlB,MAAO,GAAAY,EACPX,OAAQ,IAAAW,IAmCV,SAASS,EAAiBC,GACxBpB,EAAQqB,OACRrB,EAAQsB,YACRtB,EAAQuB,UAAYH,EAAKI,MACzBxB,EAAQyB,SAASC,EAAIN,EAAKO,GAAID,EAAIN,EAAKQ,GAAIF,EAAIN,EAAKtB,OAAQ4B,EAAIN,EAAKrB,SACrEC,EAAQ6B,SACV,CAiCA,SAASC,EAAWhB,EAAKiB,EAAKC,GAC5B,GAAGlB,EAAMiB,EACP,MAAO,CAACA,OAAKE,EAAWnB,GAE1B,IAAIoB,EAAM/B,KAAKgC,OAAOrB,EAAMiB,GAAO,GAC/BK,EAAMJ,EAAiBE,GAC3B,OAAGE,EAAM,EACAN,EAAUhB,EAAKoB,EAAM,EAAGF,GACtBI,EAAM,EACRN,EAAUI,EAAM,EAAGH,EAAKC,GAExB,CAACE,EAAI,EAAGA,EAAKA,EAAI,EAE5B,CAEA,SAASnB,EAAqBC,EAAMlB,GAClCE,EAAQqB,OACR,IAAIgB,EAAYP,EAAU,EAAGhC,GAAQwC,IAEnCtC,EAAQuC,KAAO,GAAGD,OAAU7B,IACrBX,EAAQE,EAAQwC,YAAYxB,GAAMlB,SAG3C,OADAE,EAAQ6B,UACDQ,EAAU,IAAMA,EAAU,EACnC,CAMA,SAASI,EAAU5B,GACjBb,EAAQqB,OACRrB,EAAQuC,KAAO1B,EAAK0B,KACpBvC,EAAQ0C,UAAY7B,EAAK8B,OAAS,SAClC3C,EAAQ4C,aAAe/B,EAAKgC,UAAY,SACxC7C,EAAQ8C,SAASjC,EAAKG,KAAMU,EAAIb,EAAKO,KAAKO,EAAI,GAAMd,EAAKO,KAAKtB,OAAQ4B,EAAIb,EAAKO,KAAKQ,EAAI,GAAMf,EAAKO,KAAKrB,SACxGC,EAAQ6B,SACV,CAEA,IAAIkB,EAAgBnC,EAAa,CAC/BI,KAAM,IACNlB,MAAO,GAAAY,EACPX,OAAQ,GAAAW,IAyBV,SAASgB,EAAKC,GACZ,OAAOxB,KAAKgC,MAAMR,EACpB,CAEA,SAASqB,EAAcC,GACrBjD,EAAQqB,OACRrB,EAAQsB,YACRtB,EAAQkD,IAAIxB,EAAIuB,EAAKtB,GAAID,EAAIuB,EAAKrB,GAAIF,EAAIuB,EAAKE,QAAS,EAAG,EAAIhD,KAAKiD,IAAI,GACxEpD,EAAQuB,UAAY0B,EAAKzB,MACtByB,EAAKI,UACNrD,EAAQsD,YAAcL,EAAKI,SAE7BrD,EAAQuD,OACRvD,EAAQ6B,SACV,CAqBA,MAfW,C,KAJX,WAEA,E,OAvOA,SAAiB2B,EAAOC,GAHtBzD,EAAQ0D,UAAU,EAAG,EAAG5D,EAAOC,GA6FjC,WACE,IAAIQ,EAAQoD,QAAQC,OAGlB,OAEF5D,EAAQqB,OAER,IAAIwC,EAAO7D,EAAQ8D,cAAcvD,EAAS,UAC1CP,EAAQuB,UAAYsC,EAEpB7D,EAAQyB,SAAS,EAAG,EAAGjC,EAAOM,MAAON,EAAOO,QAG5CC,EAAQ6B,SACV,CAvGEkC,GA8CA5C,EA7CaqC,EAAMQ,QA0HrB,SAAuBR,GACrB,IAAI,IAAIlF,EAAI,EAAGA,EAAIkF,EAAMS,OAAO1F,SAAUD,EACxC,IAAI,IAAI4F,EAAI,EAAGA,EAAIV,EAAMS,OAAO3F,GAAGC,SAAU2F,EAAG,CAE9C/C,EADWqC,EAAMS,OAAO3F,GAAG4F,GAG7B,CAEJ,CAjIEC,CAAaX,GACbY,eAAeC,OAAOZ,GAyMxB,SAAsBD,GACpB,IAAI,IAAIc,KAAQd,EAAMe,MACpBvB,EAAasB,EAGjB,CA7MEE,CAAYhB,GASZxD,EAAQqB,OACRrB,EAAQuB,UAAYtB,EACpBD,EAAQyB,SAAS,EAAG,EAAGjC,EAAOM,MAAON,EAAOO,QAC5CC,EAAQ6B,UA6KV,SAA0B2B,GACrBA,EAAMiB,UAAY,GACnBhC,EAAS,CACPzB,KAAM,GAAKwC,EAAMiB,UACjBrD,KAAMsD,SAASC,UAAU,CACvBhD,EAAG6B,EAAM1D,MAAQ,EAAiB,GAAb0D,EAAM9C,KAAY,EACvCkB,EAAG4B,EAAMzD,OAAS,EAAiB,GAAbyD,EAAM9C,KAAY,EACxCZ,MAAoB,GAAb0D,EAAM9C,KACbX,OAAqB,GAAbyD,EAAM9C,OAEhB6B,KAAMQ,GAGZ,CApME6B,CAAgBpB,GAmElB,SAAoBA,GAClBf,EAAS,CACPzB,KAAM,UAAUwC,EAAMqB,SACtBzD,KAAMsD,SAASC,UAAU,CACvB7E,MAAc,GAAPY,EACPX,OAAe,EAAPW,EACRiB,EAAG6B,EAAM1D,MAAe,GAAPY,EACjBkB,EAAG4B,EAAMzD,OAAgB,EAAPW,IAEpB6B,KAAMrB,GAEV,CA7EE4D,CAAUtB,GA2CZ,SAAsBA,GACpB,IAAI,IAAIlF,EAAI,EAAGA,EAAIkF,EAAMuB,cAAezG,EAAG,CACzC,IAAI8C,EAAOsD,SAASC,UAAU,CAC5B7E,MAAoB,GAAb0D,EAAM9C,KACbX,OAAqB,EAAbyD,EAAM9C,KACdiB,EAAG,GACHC,EAAG4B,EAAMzD,OAAS,IAAIzB,EAAE,IAAMA,EAAE,IAAiB,EAAbkF,EAAM9C,QAE5CU,EAAKI,MAAQgC,EAAMQ,OAAOxC,MAC1BL,EAAgBC,EAClB,CACF,CArDE4D,CAAYxB,GACZ9D,EAAgBuF,UAAUzF,EAAQ,EAAG,EAAGA,EAAOM,MAAON,EAAOO,OAC/D,E,YAUA,SAAsByD,GACjB7C,GAAiB6C,EAAMiB,YACD,IAApBjB,EAAMiB,UACPS,UAAUC,QAAQ,iBAElBD,UAAUC,QAAQ,cAEpBxE,EAAgB6C,EAAMiB,WAExB,IAAI,MAAMH,KAAQd,EAAMe,OACnBD,GAAQA,EAAKc,eAAiBd,EAAKe,cACpCH,UAAUC,QAAQ,cAEjBb,EAAKgB,cACNJ,UAAUC,QAAQ,YAGxB,E,aAsMEnC,EACItC,WACF,OAAOA,CACT,EACIX,aACF,OAAOA,CACT,EACID,YACF,OAAOA,CACT,EAGJ","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","node_modules/@parcel/runtime-js/lib/runtime-9f8804ff479cb49b.js","node_modules/@parcel/runtime-js/lib/runtime-f7e74f046996e74c.js","experiments-static/brick-breaker/modules/GameRenderer.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"kbGLj\\\":\\\"index.03a95b2b.js\\\",\\\"7otfU\\\":\\\"congruent_pentagon.f93d2ac8.png\\\"}\"));","module.exports = new __parcel__URL__(\"../\" + require('./helpers/bundle-manifest').resolve(\"7otfU\")).toString();","window.GameRenderer = function GameRenderer (canvas) {\n  let onScreenCanvas = canvas;\n  var onScreenContext =  canvas.getContext('2d');\n  canvas = document.createElement('canvas');\n  canvas.width = onScreenCanvas.width;\n  canvas.height = onScreenCanvas.height;\n  var context =  canvas.getContext('2d');\n  const gradient = context.createRadialGradient(0, 0, Math.sqrt(Math.pow(canvas.width,2) + Math.pow(canvas.height, 2)),0,0,0);\n  gradient.addColorStop(1,'rgba(255,255,255,0)');\n  gradient.addColorStop(0, 'rgba(0,0,0,0.5)');\n  var bgImage = ImageAsset(new URL('../assets/congruent_pentagon.png', import.meta.url));\n  const fontFamily = \"'Press Start 2P', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif\";\n  var width = canvas.width;\n  var height = canvas.height;\n  var unit = canvas.width / 250;\n\n  function clearCanvas () {\n    context.clearRect(0, 0, width, height);\n  }\n\n  function render (state, elapsed) {\n    clearCanvas();\n    renderBackground();\n    renderPaddle(state.paddle);\n    renderBricks(state);\n    ParticleSystem.render(elapsed);\n    renderBalls(state);\n    renderGradient();\n    renderCountdown(state);\n    drawScore(state);\n    drawPaddles(state);\n    onScreenContext.drawImage(canvas, 0, 0, canvas.width, canvas.height);\n  }\n\n  function renderGradient (state) {\n    context.save();\n    context.fillStyle = gradient;\n    context.fillRect(0, 0, canvas.width, canvas.height);\n    context.restore();\n  }\n\n  let prevCountdown = null;\n  function renderSound (state) {\n    if(prevCountdown != state.countdown) {\n      if(state.countdown === 0) {\n        AudioPool.playSFX('menu_navigate')\n      } else {\n        AudioPool.playSFX('menu_click')\n      }\n      prevCountdown = state.countdown\n    }\n    for(const ball of state.balls) {\n      if(ball && ball.paddleContact || ball.wallContact) {\n        AudioPool.playSFX('paddle_hit')\n      }\n      if(ball.brickContact) {\n        AudioPool.playSFX('brick_hit')\n      }\n    }\n  }\n\n  function gradientColor (obj) {\n    return Object.assign({}, obj, {\n      color: gradient,\n    });\n  }\n\n  function renderPaddle (paddle) {\n    renderRectangle(paddle);\n    // renderRectangle(gradientColor(paddle));\n  }\n\n  function drawPaddles (state) {\n    for(var i = 0; i < state.paddlesLeft; ++i) {\n      var rect = Geometry.Rectangle({\n        width: state.unit * 10,\n        height: state.unit * 2,\n        x: 10,\n        y: state.height - 10*(i+1) - (i+1)*(state.unit * 2),\n      });\n      rect.color = state.paddle.color;\n      renderRectangle(rect);\n    }\n  }\n\n  function getFontStyle (spec) {\n    return `${Math.min(getFontSizeForWidth(spec.text, spec.width), getFontSizeForHeight(spec.height))}px ${fontFamily}`\n  }\n\n  var scoreFont = getFontStyle({\n    text: `Score: 888`,\n    width: (unit * 30)*(1-0.05*2),\n    height: (unit * 5)*(1-0.05*2),\n  });\n\n  function drawScore (state) {\n    DrawText({\n      text: `Score: ${state.points}`,\n      rect: Geometry.Rectangle({\n        width: unit * 30,\n        height: unit * 5,\n        x: state.width - unit * 30,\n        y: state.height - unit * 5\n      }),\n      font: scoreFont\n    });\n  }\n\n  // Used a repeated background.\n  // Reference: https://stackoverflow.com/a/14121902/2066736\n  function renderBackground () {\n    if(!bgImage.dataset.loaded) {\n      // Image is not ready don't render background this\n      // render cycle.\n      return;\n    }\n    context.save()\n    // Create a pattern with this image, and set it to \"repeat\".\n    var ptrn = context.createPattern(bgImage, 'repeat'); \n    context.fillStyle = ptrn;\n    // context.fillRect(x, y, width, height);\n    context.fillRect(0, 0, canvas.width, canvas.height); \n    // context.fillStyle = gradient;\n    // context.fillRect(0, 0, canvas.width, canvas.height); \n    context.restore();\n  }\n\n  function renderRectangle (rect) {\n    context.save();\n    context.beginPath();\n    context.fillStyle = rect.color;\n    context.fillRect(flr(rect.x), flr(rect.y), flr(rect.width), flr(rect.height)); \n    context.restore();\n  }\n\n  function copyIntoOnscreenCanvas(prev, target){\n    var onscreenContext = document.getElementById('onscreen').getContext('2d');\n    var offscreenContext = offscreenCanvas.getContext('2d');\n    \n    // cut the drawn rectangle\n    var image = offscreenCanvas.getImageData(10,10,280,280); \n    // copy into visual canvas at different position\n    onscreenContext.putImageData(image, 0, 0);\n  }\n\n  function renderBricks (state) {\n    for(var i = 0; i < state.bricks.length; ++i) {\n      for(var j = 0; j < state.bricks[i].length; ++j) {\n        var rect = state.bricks[i][j]\n        renderRectangle(rect);\n        // renderRectangle(gradientColor(brick));\n      }\n    }\n  }\n\n  /**\n   * A functional binary search method takes a directionDecider function and supplies\n   * @param {Number} min \n   * min number to search with\n   * @param {Number} max \n   * max number to search with\n   * @param {Function} directionDecider\n   * directionDecider has signature, (SearchItem: Number) => Direction: Number, \n   * and should return  a positive number for going higher \n   * a negative number for searching lower and 0 if the search element is found.\n   */\n  function binSearch (min, max, directionDecider) {\n    if(min > max) {\n      return [max, undefined, min];\n    }\n    var mid = Math.floor((min + max) / 2)\n    var dir = directionDecider(mid);\n    if(dir < 0) {\n      return binSearch(min, mid - 1, directionDecider);\n    } else if (dir > 0) {\n      return binSearch(mid + 1, max, directionDecider);\n    } else {\n      return [mid-1, mid, mid+1]\n    }\n  }\n\n  function getFontSizeForWidth (text, width) {\n    context.save();\n    var fontSizes = binSearch(2, width, (size) => {\n      var minFontSize = 0;\n      context.font = `${size}px ${fontFamily}`;\n      return width - context.measureText(text).width;\n    });\n    context.restore();\n    return fontSizes[1] || fontSizes[0];\n  }\n\n  function getFontSizeForHeight (height) {\n    return getFontSizeForWidth('m', height);\n  }\n\n  function DrawText (spec) {\n    context.save();\n    context.font = spec.font;\n    context.textAlign = spec.align || 'center';\n    context.textBaseline = spec.baseline || 'middle';\n    context.fillText(spec.text, flr(spec.rect.x + 0.5 * spec.rect.width), flr(spec.rect.y + 0.5 * spec.rect.height));\n    context.restore();\n  }\n\n  var countDownFont = getFontStyle({\n    text: `m`,\n    width: (unit * 50)*(1-0.05*2),\n    height: (unit * 50)*(1-0.05*2),\n  });\n\n  function renderCountdown (state) {\n    if(state.countdown > 0) {\n      DrawText({\n        text: '' + state.countdown,\n        rect: Geometry.Rectangle({\n          x: state.width / 2 - state.unit * 50 / 2,\n          y: state.height / 2 - state.unit * 50 / 2,\n          width: state.unit * 50,\n          height: state.unit * 50,\n        }),\n        font: countDownFont\n      });\n    }\n  }\n\n  function renderBalls (state) {\n    for(var ball of state.balls) {\n      renderCircle(ball);\n      // renderBall(gradientColor(ball));\n    }\n  }\n\n  function flr (x) {\n    return Math.floor(x);\n  }\n\n  function renderCircle (circ) {\n    context.save();\n    context.beginPath();\n    context.arc(flr(circ.x), flr(circ.y), flr(circ.radius), 0, 2 * Math.PI, false);\n    context.fillStyle = circ.color;\n    if(circ.opacity) {\n      context.globalAlpha = circ.opacity;\n    }\n    context.fill();\n    context.restore();\n  }\n\n  function init () {\n\n  }\n  \n  var that = {\n    init,\n    render,\n    renderSound,\n    renderCircle,\n    get unit () {\n      return unit;\n    },\n    get height () {\n      return height;\n    },\n    get width () {\n      return width;\n    }\n  };\n  return that;\n}\n"],"names":["$18c11f3350a906ea$export$6503ec6e8aabbaf","$18c11f3350a906ea$export$f7ad0328861e2f03","$18c11f3350a906ea$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","parcelRequire","register","JSON","parse","$8fce9c2eda87a406$exports","URL","resolve","import","meta","url","toString","window","GameRenderer","canvas","onScreenCanvas","onScreenContext","getContext","document","createElement","width","height","context","gradient","createRadialGradient","Math","sqrt","pow","addColorStop","bgImage","ImageAsset","fontFamily","unit","prevCountdown","getFontStyle","spec","min","getFontSizeForWidth","text","getFontSizeForHeight","scoreFont","renderRectangle","rect","save","beginPath","fillStyle","color","fillRect","flr","x","y","restore","binSearch","max","directionDecider","undefined","mid","floor","dir","fontSizes","size","font","measureText","DrawText","textAlign","align","textBaseline","baseline","fillText","countDownFont","renderCircle","circ","arc","radius","PI","opacity","globalAlpha","fill","state","elapsed","clearRect","dataset","loaded","ptrn","createPattern","renderBackground","paddle","bricks","j","renderBricks","ParticleSystem","render","ball","balls","renderBalls","countdown","Geometry","Rectangle","renderCountdown","points","drawScore","paddlesLeft","drawPaddles","drawImage","AudioPool","playSFX","paddleContact","wallContact","brickContact"],"version":3,"file":"index.03a95b2b.js.map"}