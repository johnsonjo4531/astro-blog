{"mappings":"AAAAA,OAAOC,SAAY,SAASA,IAE1BD,OAAOE,eAAiB,KACxB,IAAIC,EAAYC,aAAaD,UAAU,aACnCE,EAAYD,aAAaE,WAAW,YAAaC,EAAE,eAAe,IAClEC,EAAeJ,aAAaE,WAAW,eAAgBC,EAAE,mBAAmB,IAAI,KAClFE,SAASC,SAASC,SAASC,KAAI,IAEjC,IACIC,EAAkB,KAEtB,MAAMC,EAAgBC,IACpBC,GAAG,kBAAkBC,SAAQC,IAC3BA,EAAGC,UAAY,GACfD,EAAGE,YAAYC,SAASC,eAAeP,EAAMQ,QAAM,GACrD,EAoGF,MAAO,C,OAjGP,WACEV,EAAgBW,WAChBtB,eAAeQ,SAASP,EAAUS,MAClCa,UAAUC,UAAU,QACpBC,SAASC,OACX,E,SAEA,WACE1B,eAAeQ,SAASP,EAAUS,MAClCC,EAAgBgB,aAChBF,SAASG,KACX,E,KAEA,WACE5B,eAAkB6B,eAClB,IAAIC,EAASzB,EAAE,gBAAgB,GAC3B0B,EAAWC,aAAaF,GAE5BL,SAASQ,KAAKF,EAAU,CACtBG,MAAOH,EAASG,MAChBC,OAAQJ,EAASI,OACjBC,KAAML,EAASK,KACfC,SAAUxB,GACLA,EAAMyB,QACPf,UAAUgB,QAAQ,YACLlC,EAAE,qBAAqB,GAC7BY,UAAY,aAEnBM,UAAUgB,QAAQ,aACLlC,EAAE,qBAAqB,GAC7BY,UAAY,aAMrB,GAHAL,EAAaC,GAGV2B,WAAWC,WAAW5B,EAAMQ,QAClBqB,aAAa,iMAGrBC,MAAK,SAAUjC,GACbA,GACD8B,WAAWI,WAAWlC,EAAMG,EAAMQ,QAEpCE,UAAUgB,QAAQ,cAClBvC,eAAeQ,SAASF,EAAaI,KACvC,SAEAV,eAAeQ,SAASF,EAAaI,KAEzC,KAIFC,EAAkBkC,iBAAgB,IAClBC,cAAc,UAAU,KAEnCvC,SAASwC,YAAYrC,OAASX,EAASW,OAGtCV,eAAe+C,YAAYrC,MAAQP,EAAUO,MAC/Ce,SAASZ,MAAMmC,QAAS,EACxBhD,eAAeQ,SAASL,EAAUO,QAElCe,SAASZ,MAAMmC,QAAS,EACxBhD,eAAeQ,SAASP,EAAUS,OACpC,IAGFuC,OAAOC,GAAG7C,EAAE,sCAAsCJ,EAAUS,UAAW,SAAS,SAAUyC,GACxF1B,SAASZ,MAAMmC,QAAS,CAC1B,IAEAC,OAAOG,kBAAiB,SAAUD,GAC7BA,EAAEE,QACA9C,SAASwC,YAAYrC,OAASX,EAASW,MAAQV,eAAe+C,YAAYrC,OAAST,EAAUS,OAC9Fe,SAASZ,MAAMmC,QAAS,EACxBhD,eAAeQ,SAASL,EAAUO,MAGxC,IAGAV,eAAesD,OAAOC,iBAAiB,eAAe,SAAUJ,GAC3DA,EAAEzC,OAASJ,EAAaI,KACzBC,EAAgBgB,cAEbwB,EAAEzC,OAASP,EAAUO,MACtBE,EAAaa,SAASZ,OAExBF,EAAgBW,WAEpB,IACAtB,eAAewD,SAASvD,EAAWE,EAAWG,GAC9CN,eAAeQ,SAASP,EAAUS,KACpC,EAMEA,KAAM,WAEV,CAzHmB","sources":["experiments-static/snake/js/views/GameView.js"],"sourcesContent":["window.GameView = (function GameView () {\n\n  window.OverlayViewSet = null;\n  let EmptyView = ViewStarters.EmptyView('EmptyView');\n  let PauseView = ViewStarters.ButtonView('PauseView', $('#pause-view')[0]);\n  let GameOverView = ViewStarters.ButtonView('GameOverView', $('#game-over-view')[0], () => {\n    MainView.loadView(MenuView.name);\n  });\n  var gameLoop = null;\n  var keyboardHandler = null;\n  \n  const displayScore = (state) => {\n    $$('.js-score-here').forEach(el => {\n      el.innerHTML = '';\n      el.appendChild(document.createTextNode(state.points))\n    });\n  }\n\n  function render () {\n    keyboardHandler.activate();\n    OverlayViewSet.loadView(EmptyView.name);\n    AudioPool.playMusic('game');\n    GameLoop.start();\n  }\n\n  function unrender () {\n    OverlayViewSet.loadView(EmptyView.name);\n    keyboardHandler.deactivate();\n    GameLoop.end();\n  }\n\n  function init () {\n    OverlayViewSet =  ViewSwitcher();\n    var canvas = $('#game-canvas')[0];\n    var renderer = GameRenderer(canvas);\n    // start up the game loop\n    GameLoop.init(renderer, {\n      width: renderer.width,\n      height: renderer.height,\n      unit: renderer.unit,\n      gameOver (state) {\n        if(state.winner) {\n          AudioPool.playSFX('game_win');\n          var header = $('#game-over-header')[0];\n          header.innerHTML = 'You Win!';\n        } else {\n          AudioPool.playSFX('game_over');\n          var header = $('#game-over-header')[0];\n          header.innerHTML = 'Game Over';\n        }\n        // display the final score\n        displayScore(state);\n        // display the quip about the score\n        // load game over view or custom name modal\n        if(scoreboard.isTopScore(state.points)) {\n          var name = PromptScreen(`\n          <h2>You got a High Score!</h2>\n          <h5>Enter your name below and hit submit click enter! You could hit cancel though if you want to be all secret secret.</h5>\n          `).then(function (name) {\n            if(name) {\n              scoreboard.writeScore(name, state.points);\n            }\n            AudioPool.playSFX('menu_click');\n            OverlayViewSet.loadView(GameOverView.name);\n          })\n        } else {\n          OverlayViewSet.loadView(GameOverView.name);\n        }\n      }\n    },);\n\n    // listen for pause event\n    keyboardHandler = KeyboardHandler(true);\n    keyboardHandler.addOnceAction('Escape', () => {\n      // toggle between\n      if(MainView.currentView.name !== GameView.name) {\n        return;\n      }\n      if (OverlayViewSet.currentView.name != PauseView.name) {\n        GameLoop.state.paused = true;\n        OverlayViewSet.loadView(PauseView.name);\n      } else {\n        GameLoop.state.paused = false;\n        OverlayViewSet.loadView(EmptyView.name);\n      }\n    });\n\n    Events.on($(`#pause-view [data-view-transition=\"${EmptyView.name}\"]`), 'click', function (e) {\n      GameLoop.state.paused = false;\n    })\n\n    Events.onPageVisibility(function (e) {\n      if(e.hidden) {\n        if(MainView.currentView.name === GameView.name && OverlayViewSet.currentView.name === EmptyView.name) {\n          GameLoop.state.paused = true;\n          OverlayViewSet.loadView(PauseView.name);\n        }\n      }\n    });\n\n    // set up sub-views\n    OverlayViewSet.events.addEventListener('view-loaded', function (e) {\n      if(e.name === GameOverView.name) {\n        keyboardHandler.deactivate();\n      } else {\n        if(e.name === PauseView.name) {\n          displayScore(GameLoop.state);\n        }\n        keyboardHandler.activate();\n      }\n    });\n    OverlayViewSet.addViews(EmptyView, PauseView, GameOverView);\n    OverlayViewSet.loadView(EmptyView.name); \n  }\n\n  return {\n    render,\n    unrender,\n    init,\n    name: \"GameView\",\n  }\n}());\n"],"names":["window","GameView","OverlayViewSet","EmptyView","ViewStarters","PauseView","ButtonView","$","GameOverView","MainView","loadView","MenuView","name","keyboardHandler","displayScore","state","$$","forEach","el","innerHTML","appendChild","document","createTextNode","points","activate","AudioPool","playMusic","GameLoop","start","deactivate","end","ViewSwitcher","canvas","renderer","GameRenderer","init","width","height","unit","gameOver","winner","playSFX","scoreboard","isTopScore","PromptScreen","then","writeScore","KeyboardHandler","addOnceAction","currentView","paused","Events","on","e","onPageVisibility","hidden","events","addEventListener","addViews"],"version":3,"file":"index.26c985e1.js.map"}